<style>

</style>

<div class="title"></div>
<div class="flexcontainer start">
    <div class="code responsive small"></div>
</div>

<script>

    (function () {
        _0.glowText(".title", ["Function 'register'",], "small glow");

        const codeSelector = ".code";

        _0.codeJs(codeSelector,
            "const register = (event) => {\n" +
            "    const body = JSON.parse(event.body);\n" +
            "    const {syncId, userName} = body;\n" +
            "    const {connectionId} = event.requestContext;\n" +
            "\n" +
            "    const putItemParams = {\n" +
            "        TableName: Z0CONNECTION_TABLE,\n" +
            "        Item: {\n" +
            "           connectionId: {S: connectionId},\n" +
            "           syncId: {S: syncId},\n" +
            "           userName: {S: userName}\n" +
            "        }\n" +
            "    }\n" +
            "\n" +
            "    await new Promise(resolve => {\n" +
            "        DDB.putItem(putItemParams, (err, data) => {\n" +
            "            if(err) {\n" +
            "                console.log(err);\n" +
            "            }\n" +
            "            resolve(data);\n" +
            "        });\n" +
            "    })\n" +
            "\n" +
            "    sendAllPositionsToAllConnections(event, syncId);\n" +
            "}\n",
        );

        const steps = [];
        steps.push(_0.highlightLinesStep(codeSelector, "1", "Lambda Function"));
        steps.push(_0.highlightLinesStep(codeSelector, "2", "Get event body"));
        steps.push(_0.highlightLinesStep(codeSelector, "3", "Get properties from body"));
        steps.push(_0.highlightLinesStep(codeSelector, "4", "Get connectionId from event"));
        steps.push(_0.highlightLinesStep(codeSelector, "6-13", "Parameter for putting item in DynamoDB"));
        steps.push(_0.highlightLinesStep(codeSelector, "15-22", "Write to DynamoDB"));
        steps.push(_0.highlightLinesStep(codeSelector, "24", "Notify all"));

        _0.setSteps(steps);

        ___();
    })()
</script>